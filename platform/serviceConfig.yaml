app: dataportal
team: data-eng
env: # Optional: You can remove this parent if you are not using it
  default: # global default variables
    ENVIRONMENT: default
  integration3: # global integration3 specific variables
    ENVIRONMENT: integration3
  uat: # global uat specific variables
    ENVIRONMENT: uat
  production: # global production specific variables
    ENVIRONMENT: production
webApps: # Optional: You can remove this parent if you are not using it
  - name: dataportal-frontend
    env:
      default:
        DATAHUB_APP_VERSION: 1.0
        DATAHUB_PLAY_MEM_BUFFER_SIZE: 10MB
        JAVA_OPTS: -Xms512m -Xmx512m -Dhttp.port=9002 -Dconfig.file=datahub-frontend/conf/application.conf -Djava.security.auth.login.config=datahub-frontend/conf/jaas.conf -Dlogback.configurationFile=datahub-frontend/conf/logback.xml -Dlogback.debug=false -Dpidfile.path=/dev/null
        DATAHUB_TRACKING_TOPIC: DataHubUsageEvent_v1
    image: "311088406905.dkr.ecr.us-east-1.amazonaws.com/dataportal-frontend-react"
    iamRole: dataportal
    accessPolicy: external # external or internal
    routes: # "/" for everything.
      - /
    replicas: 1
    port: 9002
    command: "/usr/local/bin/with-secrets"
    args:
      - datahub-frontend/bin/playBinary
    resources:
      requests:
        memory: 3Gi
    healthcheckPath: /admin
    securityGroups:
      default:
        - vpc
        - hq
  - name: dataportal-gms
    env:
      default:
        DATASET_ENABLE_SCSI: false
        EBEAN_DATASOURCE_DRIVER: com.mysql.jdbc.Driver
        GRAPH_SERVICE_IMPL: elasticsearch
        JAVA_OPTS: -Xms3g -Xmx3g
        ENTITY_REGISTRY_CONFIG_PATH: /datahub/datahub-gms/resources/entity-registry.yml
        MAE_CONSUMER_ENABLED: true
        MCE_CONSUMER_ENABLED: true
    image: "311088406905.dkr.ecr.us-east-1.amazonaws.com/dataportal-gms"
    iamRole: dataportal
    accessPolicy: external # external or internal
    routes: # "/" for everything.
      - /
    replicas: 1
    port: 8080
    command: "/usr/local/bin/with-secrets"
    args:
      - /datahub/datahub-gms/scripts/start.sh
    resources:
      requests:
        memory: 6Gi
    healthcheckPath: /health
    securityGroups:
      default:
        - vpc
        - hq
preDeploy:
  - command: /usr/local/bin/with-secrets
    args:
      - /usr/local/bin/preDeploy.sh
    iamRole: dataportal
    iamProvider: oidc
    image: 311088406905.dkr.ecr.us-east-1.amazonaws.com/dataportal-gms
