name: Push Comment

on:
  push:

jobs:
  post-push-comment:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Get and Format Username
        run: |
          formatted_username=$(echo "${{ github.actor }}" | tr '[:upper:]' '[:lower:]' | sed 's/ /-/g')
          echo "FORMATTED_USERNAME=$formatted_username" >> $GITHUB_ENV

      - name: Create Comment on Push Commit
        uses: actions/github-script@v6
        with:
          script: |
            const commitSha = context.sha;  
            const user = process.env.FORMATTED_USERNAME;
            const url = `https://contributors.datahubproject.io/${user}`;
            const body = `Hello @${user} :smile: \n\nThank you so much for pushing to this repository!\n\n![Image](https://contributors.datahubproject.io/api/og?userId=${user})\nYou can check out your contributor card and see all your past stats [here](${url})!`;

            await github.rest.repos.createCommitComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              commit_sha: commitSha,
              body: body
            });
