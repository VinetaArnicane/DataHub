apply plugin: 'com.github.kt3k.coveralls'
apply plugin: 'com.palantir.jacoco-full-report'
apply plugin: 'jacoco'

// Must match the version used in jacoco4sbt plugin.
ext.jacocoVersion = '0.7.1.201405082137'

jacoco {
  toolVersion = jacocoVersion
}

jacocoFull {
    excludeProject ":backend-server", ":hadoop-dataset-extractor-standalone", ':data-model', ':metadata-etl', ':wherehows-common'
}

// Add the jacoco plugin to each project
subprojects {
  plugins.apply('java')
  plugins.apply('jacoco')

  jacoco {
    toolVersion = jacocoVersion
  }

  jacocoTestReport {
    reports {
      xml.enabled true
      html.enabled true
      csv.enabled false
    }
  }

  jacocoFullReport {
    dependsOn test 
  }
}

// Configure the coveralls task to read the aggregated JaCoCo report
coveralls {
  sourceDirs = subprojects.sourceSets.main.allSource.srcDirs.flatten()
  jacocoReportPath = "build/reports/jacoco/jacocoFullReport/jacocoFullReport.xml"
}
